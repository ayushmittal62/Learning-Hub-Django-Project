{% extends "layout.html" %} 
{% block title %} {{ subject.name }} - Subject Details {% endblock %} 
{% block content %}

<!-- Back Button & Navigation -->
<div class="max-w-5xl mx-auto px-4 py-6">
  <div class="flex items-center justify-between mb-6">
    <a href="{% url 'all_html' %}" 
       class="group inline-flex items-center px-5 py-3 bg-gradient-to-r from-gray-700 to-gray-900 text-white rounded-xl hover:from-gray-800 hover:to-black transition-all shadow-lg hover:shadow-2xl transform hover:-translate-x-1">
      <svg class="w-5 h-5 mr-2 group-hover:animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      <span class="font-semibold">Back to All Subjects</span>
    </a>
    
    <div class="flex gap-3">
      <button onclick="shareSubject()" class="p-3 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition shadow-md hover:shadow-lg transform hover:scale-110" title="Share">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
        </svg>
      </button>
      <button onclick="toggleFavorite()" class="p-3 bg-red-500 text-white rounded-full hover:bg-red-600 transition shadow-md hover:shadow-lg transform hover:scale-110" title="Add to Favorites">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Hero Card -->
  <div class="bg-gradient-to-br from-purple-600 via-pink-500 to-red-500 rounded-3xl shadow-2xl overflow-hidden mb-8 transform hover:scale-[1.02] transition-all duration-300">
    <div class="grid md:grid-cols-2 gap-0">
      <!-- Image Section -->
      <div class="relative group overflow-hidden h-96 md:h-auto">
        <img class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" 
             src="{{ subject.image.url }}" 
             alt="{{ subject.name }}">
        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        
        <!-- Floating Badge -->
        <div class="absolute top-6 left-6 bg-white/95 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg animate-pulse">
          <span class="text-sm font-bold text-purple-600">{{ subject.get_type_display }}</span>
        </div>
      </div>
      
      <!-- Info Section -->
      <div class="p-8 md:p-12 text-white flex flex-col justify-center">
        <div class="mb-4">
          <span class="inline-block bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-semibold mb-4">
            Subject ID: #{{ subject.id }}
          </span>
        </div>
        <h1 class="text-4xl md:text-5xl font-extrabold mb-4 leading-tight animate-fade-in">
          {{ subject.name }}
        </h1>
        
        <!-- Rating and Stats -->
        <div class="flex items-center gap-6 mb-4">
          {% if avg_rating %}
          <div class="flex items-center bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg">
            <svg class="w-5 h-5 mr-1 text-yellow-300" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <span class="font-bold text-lg">{{ avg_rating|floatformat:1 }}</span>
            <span class="text-sm ml-1 opacity-90">({{ review_count }} reviews)</span>
          </div>
          {% endif %}
          
          <div class="flex items-center bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
            <span class="font-semibold">{{ student_count }}</span>
            <span class="text-sm ml-1 opacity-90">students</span>
          </div>
        </div>
        
        <div class="flex items-center gap-4 text-white/90">
          <div class="flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            <span class="text-sm">{{ subject.date_time|date:"F d, Y" }}</span>
          </div>
          <div class="flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="text-sm">{{ subject.date_time|date:"g:i A" }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Tabs -->
  <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
    <!-- Tab Navigation -->
    <div class="flex border-b border-gray-200 mb-6">
      <button onclick="switchTab('description')" id="tab-description" class="tab-btn px-6 py-3 font-semibold text-purple-600 border-b-2 border-purple-600 transition">
        üìù Description
      </button>
      <button onclick="switchTab('reviews')" id="tab-reviews" class="tab-btn px-6 py-3 font-semibold text-gray-500 hover:text-purple-600 transition">
        ‚≠ê Reviews ({{ review_count }})
      </button>
      <button onclick="switchTab('students')" id="tab-students" class="tab-btn px-6 py-3 font-semibold text-gray-500 hover:text-purple-600 transition">
        ÔøΩ Students ({{ student_count }})
      </button>
      <button onclick="switchTab('details')" id="tab-details" class="tab-btn px-6 py-3 font-semibold text-gray-500 hover:text-purple-600 transition">
        ‚ÑπÔ∏è Details
      </button>
    </div>

    <!-- Tab Content -->
    <div id="content-description" class="tab-content min-h-[200px]">
      <h3 class="text-2xl font-bold text-gray-800 mb-4">About This Subject</h3>
      {% if subject.description %}
        <p class="text-gray-700 leading-relaxed text-lg">{{ subject.description }}</p>
      {% else %}
        <p class="text-gray-500 italic text-lg">No description available yet. Check back soon for more details!</p>
      {% endif %}
    </div>

    <!-- Reviews Tab -->
    <div id="content-reviews" class="tab-content hidden">
      <h3 class="text-2xl font-bold text-gray-800 mb-6">Student Reviews (Count: {{ review_count }})</h3>
      
      <p class="mb-4 text-red-600 font-bold">DEBUG: reviews = {{ reviews|length }} items</p>
      
      {% if reviews %}
        <div class="space-y-4 min-h-[200px]">
          {% for review in reviews %}
          <div class="bg-gray-100 rounded-xl p-6 border-l-4 border-purple-500">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center">
                <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold mr-3">
                  {{ review.user.username|slice:":1"|upper }}
                </div>
                <div>
                  <div class="font-semibold text-gray-800">{{ review.user.username }}</div>
                  <div class="text-xs text-gray-500">{{ review.date_time|date:"M d, Y" }}</div>
                </div>
              </div>
              <div class="flex items-center">
                {% for i in "12345" %}
                  {% if forloop.counter <= review.rating %}
                    <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                  {% else %}
                    <svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
            <p class="text-gray-700 font-medium">{{ review.comment }}</p>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-12 bg-gray-100 rounded-lg">
          <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
          </svg>
          <p class="text-gray-500 text-lg font-bold">No reviews yet. Be the first to review!</p>
          <p class="text-red-600 mt-2">DEBUG: review_count={{ review_count }}, reviews is empty</p>
        </div>
      {% endif %}
    </div>

    <!-- Students Tab -->
    <div id="content-students" class="tab-content hidden">
      <h3 class="text-2xl font-bold text-gray-800 mb-6">Enrolled Students (Count: {{ student_count }})</h3>
      
      <p class="mb-4 text-red-600 font-bold">DEBUG: enrolled_students = {{ enrolled_students|length }} items</p>
      
      {% if enrolled_students %}
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 min-h-[200px]">
          {% for student in enrolled_students %}
          <div class="bg-purple-100 rounded-xl p-4 text-center border-2 border-purple-300">
            <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold text-2xl mx-auto mb-2">
              {{ student.name|slice:":1"|upper }}
            </div>
            <div class="font-semibold text-gray-800 text-sm">{{ student.name }}</div>
            <div class="text-xs text-gray-500">{{ student.location }}</div>
          </div>  
          {% endfor %}
        </div>
        {% if student_count > 10 %}
        <div class="mt-6 text-center">
          <p class="text-gray-500">And {{ student_count|add:"-10" }} more students...</p>
        </div>
        {% endif %}
      {% else %}
        <div class="text-center py-12 bg-gray-100 rounded-lg">
          <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
          <p class="text-gray-500 text-lg font-bold">No students enrolled yet. Be the first!</p>
          <p class="text-red-600 mt-2">DEBUG: student_count={{ student_count }}, enrolled_students is empty</p>
        </div>
      {% endif %}
    </div>

    <!-- Details Tab -->
    <div id="content-details" class="tab-content hidden min-h-[200px]">
      <h3 class="text-2xl font-bold text-gray-800 mb-6">Subject Information</h3>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-blue-100 p-6 rounded-xl border-l-4 border-blue-500">
          <div class="text-sm text-blue-600 font-semibold mb-1">Subject Name</div>
          <div class="text-xl font-bold text-gray-800">{{ subject.name }}</div>
        </div>
        <div class="bg-purple-100 p-6 rounded-xl border-l-4 border-purple-500">
          <div class="text-sm text-purple-600 font-semibold mb-1">Category</div>
          <div class="text-xl font-bold text-gray-800">{{ subject.get_type_display }}</div>
        </div>
        <div class="bg-green-100 p-6 rounded-xl border-l-4 border-green-500">
          <div class="text-sm text-green-600 font-semibold mb-1">Date Created</div>
          <div class="text-xl font-bold text-gray-800">{{ subject.date_time|date:"F d, Y" }}</div>
        </div>
        <div class="bg-orange-100 p-6 rounded-xl border-l-4 border-orange-500">
          <div class="text-sm text-orange-600 font-semibold mb-1">Average Rating</div>
          <div class="text-xl font-bold text-gray-800">
            {% if avg_rating %}
              {{ avg_rating|floatformat:1 }} ‚≠ê
            {% else %}
              No ratings yet
            {% endif %}
          </div>
        </div>
        <div class="bg-pink-100 p-6 rounded-xl border-l-4 border-pink-500">
          <div class="text-sm text-pink-600 font-semibold mb-1">Total Reviews</div>
          <div class="text-xl font-bold text-gray-800">{{ review_count }}</div>
        </div>
        <div class="bg-indigo-100 p-6 rounded-xl border-l-4 border-indigo-500">
          <div class="text-sm text-indigo-600 font-semibold mb-1">Enrolled Students</div>
          <div class="text-xl font-bold text-gray-800">{{ student_count }}</div>
        </div>
      </div>
    </div>

    <!-- Removed Resources Tab -->
  </div>

  <!-- Action Buttons -->
  <div class="grid md:grid-cols-3 gap-4">
    <button onclick="enrollNow()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 px-6 rounded-xl font-bold text-lg hover:from-green-600 hover:to-emerald-700 transition shadow-lg hover:shadow-2xl transform hover:scale-105">
      üöÄ Enroll Now
    </button>
    <button onclick="addToWatchlist()" class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-4 px-6 rounded-xl font-bold text-lg hover:from-blue-600 hover:to-indigo-700 transition shadow-lg hover:shadow-2xl transform hover:scale-105">
      ‚≠ê Add to Watchlist
    </button>
    <button onclick="downloadInfo()" class="bg-gradient-to-r from-purple-500 to-pink-600 text-white py-4 px-6 rounded-xl font-bold text-lg hover:from-purple-600 hover:to-pink-700 transition shadow-lg hover:shadow-2xl transform hover:scale-105">
      üì• Download Info
    </button>
  </div>
</div>

<!-- JavaScript for Interactivity -->
<script>
  // Tab Switching
  function switchTab(tabName) {
    console.log('Switching to tab:', tabName);
    
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.add('hidden');
      console.log('Hiding:', content.id);
    });
    
    // Remove active state from all tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.remove('text-purple-600', 'border-b-2', 'border-purple-600');
      btn.classList.add('text-gray-500');
    });
    
    // Show selected tab content
    const selectedContent = document.getElementById('content-' + tabName);
    console.log('Showing:', selectedContent.id);
    selectedContent.classList.remove('hidden');
    selectedContent.style.display = 'block'; // Force display
    
    // Add active state to selected tab
    const activeTab = document.getElementById('tab-' + tabName);
    activeTab.classList.add('text-purple-600', 'border-b-2', 'border-purple-600');
    activeTab.classList.remove('text-gray-500');
    
    console.log('Tab switch complete');
  }

  // Interactive Functions
  function shareSubject() {
    alert('üì§ Share functionality - Subject: {{ subject.name }}');
  }

  function toggleFavorite() {
    const btn = event.currentTarget;
    btn.classList.toggle('bg-red-500');
    btn.classList.toggle('bg-pink-500');
    alert('‚ù§Ô∏è Added to favorites!');
  }

  function enrollNow() {
    alert('üéì Enrolling in {{ subject.name }}...');
  }

  function addToWatchlist() {
    alert('‚≠ê Added {{ subject.name }} to your watchlist!');
  }

  function downloadInfo() {
    alert('üì• Downloading information for {{ subject.name }}...');
  }
</script>

<style>
  @keyframes fade-in {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .animate-fade-in {
    animation: fade-in 0.6s ease-out;
  }
  
  /* Fix for tab content visibility */
  .tab-content {
    display: block;
  }
  
  .tab-content.hidden {
    display: none;
  }
</style>

{% endblock %}